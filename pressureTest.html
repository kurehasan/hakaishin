<!doctype html>
<html>
  <head>
	<meta charset="utf-8">
	<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		$(function(){
			//MQTT Brokerへの接続設定
			client = new Paho.MQTT.Client("mqtt.isc.ac.jp", 8443, "pressureClient-" + Math.random());
			
			//接続切断時のコールバック関数設定
			client.onConnectionLost = onConnectionLost;

			//MQTT Brokerへの接続処理
			client.connect({userName:"isc", password:"iwasaki3_", useSSL:true, onSuccess:onConnect});
			//メッセージ受信時の処理
			client.onMessageArrived = onMessageArrived;

		});

		//接続完了時のコールバック関数
		function onConnect() {
			console.log("MQTT Connected");
			client.subscribe("isc/pressure/01");
		}

		//接続切断時のコールバック関数
		function onConnectionLost(responseObject) {
			console.log("MQTT Connection Lost");
			client.connect({userName:"isc", password:"iwasaki3_", useSSL:true, onSuccess:onConnect});
		}

		//Subscribeしたメッセージを受信した時に呼び出される関数
		function onMessageArrived(message) {
			let obj = JSON.parse(message.payloadString);
			console.log(obj);
		}
	</script>
  </head>
  <body>
  </body>
</html>
